import nodemailer from 'nodemailer';
import Log from './log';
const log = Log('sendEmail');

class Sender{

	get defaultOptions() {
		return {
			from: '"Task Notice 👥" <admin@gmail.com>', // sender address
			to: '', // list of receivers
			subject: '📣 你有一个新的通知', // Subject line
			html: null,
			text: null
		}
	}

	constructor(options) {
		if(!options) throw new Error('options can not undefined.');
		this.options = options;
		this.transporter = nodemailer.createTransport(this.options);
		log.debug(`sendEmail对象构造成功，你的参数为：%o`, options);
	}

	send(options) {
		options = Object.assign({}, this.defaultOptions, options);
		log.debug(`开始发送一封新邮件，请求参数为：%o`, options);
		return new Promise((resolve, reject) => {
			this.transporter.sendMail(options, function(error, info){
				if(error){ log.error(`邮件发送失败`); return reject(error); }
				log.debug(`邮件发送成功`);
				resolve(info);
			});
		});
	}

}

module.exports = Sender;
