import nodemailer from 'nodemailer';
import Log from './log';
const log = Log('sendEmail');

class Sender{

	get defaultOptions() {
		return {
			from: '"Task Notice ğŸ‘¥" <admin@gmail.com>', // sender address
			to: '', // list of receivers
			subject: 'ğŸ“£ ä½ æœ‰ä¸€ä¸ªæ–°çš„é€šçŸ¥', // Subject line
			html: null,
			text: null
		}
	}

	constructor(options) {
		if(!options) throw new Error('options can not undefined.');
		this.options = options;
		this.transporter = nodemailer.createTransport(this.options);
		log.debug(`sendEmailå¯¹è±¡æ„é€ æˆåŠŸï¼Œä½ çš„å‚æ•°ä¸ºï¼š%o`, options);
	}

	send(options) {
		options = Object.assign({}, this.defaultOptions, options);
		log.debug(`å¼€å§‹å‘é€ä¸€å°æ–°é‚®ä»¶ï¼Œè¯·æ±‚å‚æ•°ä¸ºï¼š%o`, options);
		return new Promise((resolve, reject) => {
			this.transporter.sendMail(options, function(error, info){
				if(error){ log.error(`é‚®ä»¶å‘é€å¤±è´¥`); return reject(error); }
				log.debug(`é‚®ä»¶å‘é€æˆåŠŸ`);
				resolve(info);
			});
		});
	}

}

module.exports = Sender;
