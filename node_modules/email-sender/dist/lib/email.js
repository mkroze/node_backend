'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _nodemailer = require('nodemailer');

var _nodemailer2 = _interopRequireDefault(_nodemailer);

var _log = require('./log');

var _log2 = _interopRequireDefault(_log);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var log = (0, _log2.default)('sendEmail');

var Sender = function () {
	_createClass(Sender, [{
		key: 'defaultOptions',
		get: function get() {
			return {
				from: '"Task Notice ğŸ‘¥" <admin@gmail.com>', // sender address
				to: '', // list of receivers
				subject: 'ğŸ“£ ä½ æœ‰ä¸€ä¸ªæ–°çš„é€šçŸ¥', // Subject line
				html: null,
				text: null
			};
		}
	}]);

	function Sender(options) {
		_classCallCheck(this, Sender);

		if (!options) throw new Error('options can not undefined.');
		this.options = options;
		this.transporter = _nodemailer2.default.createTransport(this.options);
		log.debug('sendEmailå¯¹è±¡æ„é€ æˆåŠŸï¼Œä½ çš„å‚æ•°ä¸ºï¼š%o', options);
	}

	_createClass(Sender, [{
		key: 'send',
		value: function send(options) {
			var _this = this;

			options = Object.assign({}, this.defaultOptions, options);
			log.debug('å¼€å§‹å‘é€ä¸€å°æ–°é‚®ä»¶ï¼Œè¯·æ±‚å‚æ•°ä¸ºï¼š%o', options);
			return new Promise(function (resolve, reject) {
				_this.transporter.sendMail(options, function (error, info) {
					if (error) {
						log.error('é‚®ä»¶å‘é€å¤±è´¥');return reject(error);
					}
					log.debug('é‚®ä»¶å‘é€æˆåŠŸ');
					resolve(info);
				});
			});
		}
	}]);

	return Sender;
}();

module.exports = Sender;